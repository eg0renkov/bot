#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Тест исправления повторной ошибки валидации
"""

def test_repeat_fix():
    """Тест исправления повторного использования"""
    print("=== ТЕСТ ИСПРАВЛЕНИЯ ПОВТОРНОГО ИСПОЛЬЗОВАНИЯ ===")
    print()
    
    print("ПРОБЛЕМА БЫЛА:")
    print("- Первый раз работает, письмо отправляется")
    print("- Второй раз - ошибка валидации reply_markup")
    
    print()
    print("ИСПРАВЛЕНИЯ:")
    print("1. Добавлена очистка состояния в send_error_message()")
    print("2. Принудительная очистка при успешном выполнении")
    print("3. Создание свежих клавиатур для каждого использования")
    print("4. Добавлено отладочное логирование")
    
    print()
    print("ИЗМЕНЕНИЯ В КОДЕ:")
    print("- send_error_message() теперь очищает состояние FSM")
    print("- create_fresh_confirmation_menu() создает новые объекты")
    print("- При успехе сразу вызывается state.clear()")
    print("- Добавлено логирование состояния для отладки")
    
    print()
    print("ЧТО ДОЛЖНО ПРОИЗОЙТИ:")
    print("1. Первый раз: работает как обычно")
    print("2. Второй раз: ТОЖЕ должен работать без ошибок")
    print("3. Состояние FSM очищается корректно")
    print("4. Клавиатуры создаются заново каждый раз")
    
    print()
    print("ТЕСТИРОВАНИЕ:")
    print("1. Запустите бота")
    print("2. Попробуйте настроить email")
    print("3. После первой попытки попробуйте еще раз")
    print("4. Проверьте консоль на наличие DEBUG сообщений")
    
    return True

if __name__ == "__main__":
    test_repeat_fix()